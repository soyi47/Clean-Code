# 8. 경계

시스템의 모든 소프트웨어를 직접 개발하는 경우는 드물다. 때로는 패키지나 오픈 소스를 이용한다. 이 장에서는 외부 코드를 우리 코드에 깔끔하게 통합하는 방법, 소프트웨어 간의 경계를 깔끔하게 처리하는 기법을 살펴본다.

<br />

### 외부 코드 사용하기

경계 인터페이스를 클래스 안으로 숨긴다. 그러면 경계 인터페이스가 변하더라도, 나머지 프로그램에 영향을 미치지 않는다. 클래스 안에서 관리하고 변환하면 되기 때문이다. 또 클래스로 한번 감싸므로 프로그램에 필요한 인터페이스만 제공할 수 있다. 이를 통해 **코드를 이해하기는 쉽지만 오용하기는 어렵게 만든다. 클래스로 프로그램에 필요한 인터페이스만 제공하여, 다른 프로그램이 설계 규칙과 비즈니스 규칙을 따르도록 강제할 수 있다.**

경계 인터페이스를 모두 캡슐화하라는 것은 아니다. **경계 인터페이스**를 이용할 때는 여기저기 넘기지 말고, 이를 이용하는 클래스나, 클래스 계열 **밖으로 노출되지 않도록 주의하라는 것**이다.

<br />

### 경계 살피고 익히기

외부 코드는 익히기도, 통합하기도 어렵다. 두 가지를 동시에 하기에는 더 어렵다. 이때 먼저 간단한 테스트 케이스를 작성해 외부 코드를 익힐 수 있다. 이를 **학습 테스트**라고 부른다. 

- 로깅 기능을 직접 구현하는 대신, 외부 패키지를 사용하려 한다고 가정하자. 패키지를 내려 받아 소개 페이지를 열고, 문서를 자세히 읽기 전에 첫 번째 테스트 케이스를 작성한다. 화면에 'hello'를 출력하는 테스트 케이스를 작성하자. 테스트 케이스를 충족하는 과정에서, 구글을 뒤지고, 문서를 읽고, 테스트를 돌린다. 그 과정에서 패키지가 돌아가는 방식을 상당히 많이 이해하고, 여기서 얻은 지식을 간단한 단위 테스트 케이스 몇 개로 표현할 수 있다.

학습 테스트는 필요한 지식만 확보하는 손쉬운 방법이다. 이해도를 높여주는 정확한 실험이다. 투자하는 노력보다 얻는 성과가 더 크다. 패키지의 새 버전이 나온다면 학습 테스트를 돌려 차이가 있는지 확인한다. 패키지 작성자는 버그를 수정하고, 기능도 추가하므로, 새 버전이 나올 때마다 새로운 위험이 생긴다. 새 버전이 우리 코드와 호환되지 않으면 학습 테스트가 이 사실을 곧바로 밝혀낸다.

학습 테스트를 이용하여 패키지에 대한 학습을 하지 않더라도, **실제 코드와 동일한 방식으로 인터페이스를 사용하는 테스트 케이스가 필요**하다. 이런 **경계 테스트가 있다면 패키지의 새 버전으로 이전하기 쉬워진다.**

<br />

### 아직 존재하지 않는 코드를 사용하기

경계와 관련해 또 다른 유형은, **아는 코드와 모르는 코드를 분리하는 경계**다. 때로는 지금 알려고 해도 알 수가 없는 코드 영역도 있다. **모르는 코드를 어떻게 사용할 수 있을지 구체적인 방법은 모르지만, 자체적으로 인터페이스는 정의할 수 있다.** 우리가 바라는 인터페이스를 구현하면, 우리가 **인터페이스를 전적으로 통제한다는 장점이 생긴다. 또한 코드 가독성도 높아지고 코드 의도도 분명해진다.** 이후 몰랐던 코드가 API로 정의되면, API 사용을 캡슐화하고, API가 바뀔 때 수정할 코드를 한곳으로 모아둘 수 있다.

이와 같은 설계는 테스트도 아주 편하다. 모르는 코드에 대해 기대하는 동작을 Fake 클래스로 만들어두면, 이를 사용하는 동작들에 대한 테스트를 진행할 수 있다. 이후 사용할 API 인터페이스가 나오면, 경계 테스트 케이스를 생성해 API를 올바로 사용하는지 테스트할 수도 있다.

<br />

### 깨끗한 경계

- 경계에서는 변경이 많이 일어난다. 설계가 우수하다면 변경에 많은 투자와 재작업이 필요하지 않다. 직접 통제하지 못하는 코드를 사용할 때는 너무 많은 투자를 하거나 변경 비용이 지나치게 커지지 않도록 주의한다.
- 경계에 위치하는 코드는 깔끔하게 분리한다. 기대치를 정의하는 테스트 케이스도 작성한다. 외부 코드에 휘둘리지 않도록, 이쪽에서 외부 패키지를 세세하게 알 필요 없도록 한다. 외부 페키지를 호출하는 코드를 가능한 줄여 경계를 관리한다. 코드 가독성이 높아지고, 경계 인터페이스를 사용하는 일관성도 높아지며, 외부 패키지에 변경이 있을 때, 변경할 코드도 줄어든다.

<br />
