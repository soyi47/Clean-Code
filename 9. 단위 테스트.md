# 9. 단위 테스트

애자일과 TDD 덕택에 단위 테스트를 자동화하는 프로그래머들이 이미 많아졌으며 점점 더 늘어나는 추세다. 하지만 우리 분야에 테스트를 추가하려고 급하게 서두르는 와중에 많은 프로그래머들이 제대로 된 테스트 케이스를 작성해야 한다는 미묘하고 중요한 사실을 놓쳐버렸다.

<br />

### TDD 법칙 세 가지

1. 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
2. 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
3. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

위 세 가지 규칙을 따르면 개발과 테스트가 대략 30초 주기로 묶인다. 테스트 코드와 실제 코드가 함께 나올뿐더러 테스트 코드가 실제 코드보다 불과 몇 초 전에 나온다.

<br />

### 깨끗한 테스트 코드 유지하기

이렇게 개발을 진행하면, 실제 코드를 사실 전부 테스트하는 테스트 케이스가 나온다. 하지만 실제 코드와 맞먹을 정도로 방대한 테스트 코드는 심각한 관리 문제를 유발하기도 한다.

오히려 지저분한 테스트 코드는 테스트를 안 하는 것만 더 못하다. 문제는 실제 코드가 진화하면, 테스트 코드도 변해야 한다는 데 있다. 그런데 테스트 코드가 지저분하면 변경하기 어려워진다. 테스트 코드가 복잡할수록 실제 코드를 짜는 시간보다 테스트 케이스를 추가하는 시간이 더 걸린다. 실제 코드를 변경하여 기존 테스트 케이스가 실패하기 시작하면, 지저분한 코드 때문에 실패하는 테스트 케이스를 통과시키기는 점점 더 어려워진다. 테스트 코드는 계속해서 늘어나는 부담이 된다. 결국 테스트 슈트를 폐기하지 않으면 안 되는 상황에 처한다.

하지만 테스트가 없으면 개발자는 자신이 수정한 코드가 제대로 도는지 확인할 방법이 없다. 테스트가 없으면 이쪽을 수정해도, 저쪽이 안전하다는 사실을 검증하지 못한다. 결함율이 높아지기 시작한다. 결함이 많아지면 변경이 생겼을 때, 득보다 해가 크다 생각해 개발자는 코드를 더 이상 정리하지 않게 된다. 결국 코드는 망가지기 시작한다.

테스트 코드는 실제 코드 못지 않게 중요하다. 테스트 코드는 사고와 설계에 주의가 필요하다. 실제 코드 못지 않게 깨끗하게 짜야 한다.

#### 테스트는 유연성, 유지보수성, 재사용성을 제공한다.

테스트 코드를 깨끗하게 유지하지 않으면 결국 잃어버리게 되고, 테스트 코드가 없으면 실제 코드를 유연하게 만드는 버팀목도 사라진다. **코드의 유연성, 유지보수성, 재사용성을 제공하는 버팀목은 바로 단위 테스트다. 테스트 케이스가 있으면 변경이 두렵지 않다.** 테스트가 없다면 모든 변경은 잠정적인 버그다. 테스트 케이스가 없으면 개발자는 버그가 숨어들까 두려워 변경을 주저하게 된다. 반면 테스트 케이스가 많고, **테스트 커버리지가 높으면 변경에 대한 공포와 두려움은 줄어든다. 안심하고 아키텍처와 설계를 개선할 수 있다.** 테스트 케이스가 있으면 변경이 쉬워진다.

테스트 코드가 지저분하면 결국 코드를 변경하고 코드 구조를 개선하는 능력도 떨어진다. 결국 실제 코드도 지저분해진다. 테스트 코드가 망가지면 이를 잃어버리고, 실제 코드도 함께 망가진다.

<br />