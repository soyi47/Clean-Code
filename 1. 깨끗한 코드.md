# 1. 깨끗한 코드

+ 이 책을 읽고 나면 코드에 대해 많은 사실을 배우리라. 좋은 코드와 나쁜 코드를 구분하는 능력도 생긴다. 게다가 좋은 코드를 작성하는 방법도 익힌다. 마지막으로 나쁜 코드를 좋은 코드로 바꾸는 실력도 쌓인다.

<br />

### 코드가 존재하리라

+ 코드의 종말이 코앞에 닥쳤다고 주장하는 사람이 없지 않아 있다. 코드를 자동으로 생성하는 시대가 다가온다는 말이다. 그때가 되면 프로그래머는 필요가 없다. ... 헛소리! 앞으로 코드가 사라질 가망은 전혀 없다! 왜? **코드는 요구사항을 상세히 표현하는 수단**이니까! **기계가 실행할 정도로 상세하게 요구사항을 명시하는 작업, 바로 이것이 프로그래밍이다. 이렇게 명시한 결과가 바로 코드다.**

  언젠가 코드가 사라지리라 생각하는 사람들은, 요구사항을 모호하게 줘도 우리 의도를 정확히 꿰뚫어 프로그램을 완벽하게 실행하는 그런 기계가 나오리라 기대한다. 절대로 불가능한 기대다. 창의력과 직관을 보유한 우리 인간조차도 고객의 막연한 감정만 갖고는 성공적인 시스템을 구현하지 못한다. 지금까지 우리가 요구사항 명세 분야에서 배운 교훈은, **제대로 명시한 요구사항은 코드만큼 정형적이며 테스트 케이스로 사용해도 좋다는 사실**이다!

  **궁극적으로 코드는 요구사항을 표현하는 언어라는 사실**을 명심한다. 요구사항에 더욱 가까운 언어나 요구사항에서 정형 구조를 뽑아내는 도구를 만들 수도 있다. 하지만 어느 순간에는 정밀한 표현이 필요하고, 그 필요성을 없앨 방법은 없다. 그러므로 코드도 항상 존재하리라.

<br />

### 나쁜 코드

+ **80년대 후반 킬러 앱 하나를 구현한 회사**가 있었다. 그런데 제품 출시 주기가 점차 늘어지기 시작했다. 버그가 다음 버전에 그대로 남아있고, 프로그램의 시동 시간이 길어지고 죽는 횟수도 늘어났다. 쓰다가 하도 화가 나서 닫아버렸던 날을 기억한다. 그 후로 다시는 사용하지 않았고 그 회사는 얼마 못가 망했다. 

  20여년 후 그 회사 초창기 직원을 우연히 만나 자초지종을 들었다. 그들은 출시에 바빠 코드를 마구 짰다. 기능을 추가할수록 코드는 엉망이 되었고, 결국 감당 불가능한 수준에 이르렀다. **회사가 망한 원인은 바로 나쁜 코드 탓이었다.**

  + 킬러 앱(Killer App) : 단순한 상품이나 발명품의 의미를 넘어 시장을 크게 변화시키고, 나아가 사회인식과 문화코드까지 바꿔버리는 제품 또는 서비스를 통칭. 주로 컴퓨터 프로그래밍 소프트웨어 제품 중에 그 인기나 유용성이 아주 높아서 그 제품을 사용하기 위해서 필요한 하드웨어나 운영체제 등의 플랫폼까지도 구매하게 만들 정도로 인기와 수요가 높은 응용 프로그램 제품.

+ 나쁜 코드에 발목이 잡혀 고생하는 일은 고행과 같다. 엉킨 덩굴과 숨겨진 함정으로 가득한 나쁜 코드를 힘겹게 헤쳐나간다. 단서나 실마리를 찾으려 발버둥치지만 소용 없다. 무의미한 코드만이 끝없이 펼쳐진다. 우리 모두 자신이 짠 **쓰레기 코드를 쳐다보며 나중에 손보겠다고 생각한 경험이 있다.** 안 돌아가는 프로그램보다 돌아가는 쓰레기가 좋다고 스스로를 위로한 경험이 있다. 물론 그 시절 우리는 르블랑의 법칙(leblanc's law: **Later Equals Never**)을 몰랐다. **나중은 결코 오지 않는다.**

<br />

### 나쁜 코드로 치르는 대가

+ **나쁜 코드는 개발 속도를 크게 떨어뜨린다**. ... 간단한 변경은 없다. 매번 얽히고설킨 코드를 '해독'해서 얽히고 설킨 코드를 더한다. 시간이 지나면서 쓰레기 더미는 점점 깊어지고 커진다. 청소할 방법이 없다.

  **나쁜 코드가 쌓일수록 팀 생산성은 떨어져 마침내 0에 근접한다.** 관리층은 나름대로 복구를 시도하려 인력을 추가로 투입한다. 하지만 새 인력은 1. 시스템 설예에 대한 조예가 깊지 않고, 2. 기존의 팀과 함께 생산성을 높여야 한다는 압력에 시달린다. 결국 나쁜 코드를 더 많이 양산한다.

#### 원대한 재설계의 꿈

+ 마침내 팀은 반기를 들어 관리층에 재설계를 요구한다. 결국 원대한 재설계를 맡은 타이거 팀이 구성된다. 모두가 타이거 팀에 합류하고 싶어하지만 유능한 사람들만이 차출된다. 나머지는 현재 시스템을 유지보수하게 되고, 이제 두 팀은 경주를 시작한다.

  타이거 팀은 기존 시스템 기능을 모두 제공하면서 추가되는 변경을 모두 따라잡아야 한다. 때때로 이 경주는 아주 오래 이어져, 10년이 넘는 경우도 보았다. 새 시스템이 기존 시스템을 대체할 수 있을 즈음이면 초창기 타이거 팀원은 모두 떠났고 새로운 타이거 팀원들은 새 시스템을 설계하자고 나선다. 현재 시스템은 너무 엉망이기 때문이다.

#### 태도

+ **코드가 왜 그렇게 되었을까?** 잘못은 전적으로 우리 프로그래머에게 있다. **프로그래머가 전문가답지 못했기 때문**이다. **프로그래머는 프로젝트를 계획하는 과정에 깊숙히 관여한다.** 사람들은 우리에게, 요구사항에 대해 현실성을 자문받고, 일정과 함께 도움을 요청 받고, 정보를 요청 받는다. 그러므로 **프로젝트 실패는 우리에게도 커다란 책임이 있다. 특히 나쁜 코드가 초래하는 실패에는 더더욱** 책임이 크다.
+ 어떤 환자가 시간이 너무 걸리니까 수술 전 손을 씻지 말라고 요구한다. 하지만 의사는 질병과 감염의 위험을 환자보다 잘 알고 있다. 환자 말을 그대로 따르는 것은 전문가답지 못하다. 그래서 단호하게 거부한다. 프로그래머도 마찬가지다. **나쁜 코드의 위험을 이해하지 못한 관리자의 말을 그대로 따르는 행동은 전문가답지 못하다.**

#### 원초적 난제

+ 기한을 맞추려면 나쁜 코드를 양산할 수 밖에 없다고 느끼며, 빨리 가려고 시간을 들이지 않는다. 하지만 이는 틀렸다. 기한을 맞추는 유일한 방법, **빨리 가는 유일한 방법은, 언제나 코드를 깨끗하게 유지하는 습관**이다.

#### 깨끗한 코드라는 예술?

+ "깨끗한 코드를 어떻게 작성할까?" 깨끗한 코드가 무엇인지 모르면 깨끗한 코드를 만들려고 애써봤자 소용이 없다.  깨끗한 코드를 구현하는 행위는 그림을 그리는 행위와 비슷하다. 잘 그린 그림을 구분하는 능력이, 그림을 잘 그리는 능력은 아니다. **깨끗한 코드와 나쁜 코드를 구분할 줄 안다고 깨끗한 코드를 작성할 줄 안다는 뜻은 아니다.**
+ 열쇠는 **'코드 감각'**이다. **이를 활용해 자잘한 기법들을 적용하는 절제와 규율이 필요**하다. 어떤 사람은 이 감각을 타고나고, 어떤 사람은 투쟁해서 얻어야 한다. **'코드 감각'이 있으면, 좋은 코드와 나쁜 코드를 구분하고, 나쁜 코드를 좋은 코드로 개선할 방안을 떠올린다.** '코드 감각'으로 최고 방안을 선택하여 좋은 코드를 향해 이동하는 경로를 계획한다.

#### 깨끗한 코드란?

깨끗한 코드의 정의는 다양하다. 유명하고 노련한 프로그래머들의 의견을 알아본다.

+ **비야네 스트롭스트룹(Bjarne Stroustrup)**

  > 나는 우아하고 효율적인 코드를 좋아한다. 논리가 간단해야 버그가 숨어들지 못한다. 의존성을 최대한 줄여야 유지보수가 쉬워진다. 오류는 명백한 전략에 의거해 철저히 처리한다. 성능을 최적으로 유지해야 사람들이 원칙 없는 최적화로 코드를 망치려는 유혹에 빠지지 않는다. 깨끗한 코드는 한 가지를 제대로 한다.

  + '우아한' 코드 === **'보기에 즐거운' 코드.**

  + 효율은 단순 **속도**만을 뜻하지 않는다. **자원**을 낭비하는 코드도 우아하지 못하다.

  + 나쁜 코드를 고치면서 오히려 더 나쁜 코드를 만들기 쉽다. 

    창문이 깨진 건물은 누구도 신경쓰지 않는다는 인상을 풍긴다. 사람들은 창문이 더 깨져도 상관하지 않고, 자발적으로 창문을 더 깨기도 한다. 건물에는 낙서와 쓰레기가 생기고 방치되기 시작한다. 일단 창문이 깨졌을 때 잘못 관리하면 건물의 쇠퇴하는 과정이 진행된다.

  + 세세한 사항까지 신경 쓴, 철저한 오류처리가 필요하다. 깨끗한 코드는 **세세한 사항까지 꼼꼼하게 처리하는 코드**다.

  + 깨끗한 코드는 **한 가지를 잘 한다.**

+ **그래디 부치(Grady Booch)**

  > 깨끗한 코드는 단순하고 직접적이다. 깨끗한 코드는 잘 쓴 문장처럼 읽힌다. 깨끗한 코드는 결코 설계자의 의도를 숨기지 않는다. 오히려 명쾌한 추상화와 단순한 제어문으로 가득하다.

  + **가독성**

    깨끗한 코드는 잘 쓴 문장처럼 읽혀야 한다. 좋은 소설과 마찬가지로 깨끗한 코드는 해결할 문제의 긴장을 명확히 드러내야 한다. 긴장을 쌓으며 클라이막스에 이르러 명백한 해법을 제시하며 긴장과 문제를 풀어낸다.

  + **명쾌한 추상화**

    코드는 사실에 기반하여 반드시 필요한 내용만 담아야 한다. 코드를 읽는 이에게 프로그래머가 단호하다는 인상을 줘야 한다.

+ **큰(big) 데이브 토마스(Dave Thomas)**

  > 깨끗한 코드는 작성자가 아닌 사람도 읽기 쉽고 고치기 쉽다. 단위 테스트 케이스와 인수 테스트 케이스가 존재한다. 깨끗한 코드에는 의미 있는 이름이 붙는다. 특정 목적을 달성하는 방법은 (여러 가지가 아니라) 하나만 제공한다. 의존성은 최소이며 각 의존성을 명확히 정의한다. API는 명확하며 최소로 줄였다. 언어에 따라 필요한 모든 정보를 코드만으로 명확히 표현할 수 없기 때문에 코드는 문학적으로 표현해야 마땅하다.

  + **다른 사람이 1. 읽기 쉽고 2. 고치기 쉬운** 코드

    읽기 쉬운 코드와 고치기 쉬운 코드는 엄연히 다르다.

  + **테스트 케이스**

    테스트 주도 개발(TDD, Test Driven Development)은 오늘날 가장 근본적인 원칙 중 하나다. 아무리 코드가 우아해도, 가독성이 높아도, 테스트 케이스가 없으면 깨끗하지 않다.

  + 최소

    작은 코드에 가치를 둔다. **작을수록 좋다.**

  + **문학적으로 표현한 코드**

    인간이 읽기 좋은 코드를 작성한다.

+ **마이클 페더스(Michael Feathers)**

  > 깨끗한 코드의 특징은 많지만 그 중에서도 모두를 아우르는 특징이 하나 있다. 깨끗한 코드는 언제나 누군가 주의 깊게 짰다는 느낌을 준다. 고치려고 살펴봐도 딱히 손 댈 곳이 없다. 작성자가 이미 모든 사항을 고려했으므로. 고칠 궁리를 하다보면 언제가 제자리로 돌아온다. 그리고 누군가 남겨준 코드, 누군가 주의 깊게 짜놓은 작품에 감사를 느낀다.

  + **주의 깊게 작성한 코드.**

    **누군가 시간을 들여** 깔끔하고 단정하게 정리한 코드. **세세한 사항까지 꼼꼼하게 신경 쓴 코드. 주의를 기울인 코드.** 

    '주의'. 이것이 이 책의 주제다. 책의 부제를 붙인다면 '코드를 주의 깊게 짜는 방법'이 적당하다.

+ **론 제프리스(Ron Jeffries)**

  > + **중복과 표현력만 신경 써도 깨끗한 코드라는 목표에 성큼 다가선다.**
  >
  > + 모든 프로그램이 아주 유사한 요소로 이뤄진다는 사실을 깨달았다. 한 가지 예가 '집합에서 항목 찾기'다. 프로그램을 짜다 보면 어떤 집합에서 특정 항목을 찾아낼 필요가 자주 생긴다. 이런 상황이 발생하면 **나는 추상 메서드나 추상 클래스를 만들어 실제 구현을 감싼다. 그러면 여러 장점이 생긴다.** 
  >
  >   이제 실제 기능은 아주 간단한 방식으로 구현해도 괜찮다. 다른 코드는 추상 클래스나 추상 메서드가 제공하는 기능을 사용하므로 실제 구현은 언제든지 바꿔도 괜찮다. 지금은 간단하게 빨리 구현했다가 나중에 필요할 때 바꾸면 된다.
  >
  >   또 집합을 추상화 하면 '진짜' 문제에 신경 쓸 여유가 생긴다. 간단한 찾기 기능이 필요한데 온갖 집합 기능을 구현하느라 시간과 노력을 낭비할 필요가 없어진다.
  >
  > + 중복 줄이기, 표현력 높이기, 초반부터 간단한 추상화 고려하기. 내게는 이 세가지가 깨끗한 코드를 만드는 비결이다.

  + **중복을 피하라. 한 기능만 수행하라. 제대로 표현하라. 작게 추상화하라.**

+ **워드 커닝햄(Ward Cunningham)**

  > 코드를 읽으면서 짐작했던 기능을 각 루틴이 그대로 수행한다면 깨끗한 코드라 불러도 되겠다. 코드가 그 문제를 풀기 위한 언어처럼 보인다면 아름다운 코드라 불러도 되겠다.

  + **읽으면서 짐작한 대로 돌아가는 코드**

    깨끗한 코드는 읽으면서 놀랄 일이 없어야 한다. 코드를 독해하느라 머리를 쥐어짤 필요가 없어야 한다. 명백하고 단순해 마음이 클리는 코드다. 모듈을 읽으면 다음에 벌어질 상황이 보인다. 이정도로 깨끗한 코드는 **너무도 잘 짜놓은 코드라 읽는 이가 그 사실을 모르고 넘어간다.**

  + 아름다움

    **언어를 단순하게 보이도록 만드는 책임은 우리에게 있다.**

<br />

